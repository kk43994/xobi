# Excel批量处理使用指南

> Xobi Visual Factory - Excel智能处理模块

---

## 快速开始

### 第一步：启动项目

1. 双击运行 `Xobi启动器.bat`
2. 浏览器会自动打开 http://localhost:8001/index.html
3. 在主页点击 **📊 Excel智能处理** 卡片

### 第二步：上传Excel文件

1. 点击上传区域或拖拽文件
2. 支持格式：`.xlsx`, `.csv`, `.xls`
3. 系统会自动解析表格结构

**支持的表格格式示例** (taiyang.xlsx):
```
| SKUID          | 产品名称                    | 产品图片 (URL逗号分隔)   | 原价格 | 折扣价 |
|----------------|---------------------------|------------------------|-------|--------|
| 430087286034   | [จัดส่งจากกรุงเทพฯ] ...  | https://...jpg,...jpg  | 40    | 20     |
```

### 第三步：字段映射

系统会智能识别列名，你也可以手动选择：

- **商品ID列** - 商品唯一标识（如 SKUID）
- **商品标题列** - 商品名称（如 产品名称）
- **商品图片列** - 图片URL（支持逗号分隔多图）
- **价格列** - 可选

点击 **解析表格** 继续。

### 第四步：查看商品列表

系统会以网格形式展示所有商品：
- 商品主图（自动代理，解决防盗链）
- 商品标题
- 价格信息
- 处理状态

### 第五步：批量处理

#### 方式1：批量改写标题

1. 点击右上角 **批量改写标题**
2. 选择配置：
   - 目标语言：中文/泰语/英语
   - 风格：简洁/吸睛/本地化
   - 最大长度：20-200字
3. 确认后开始批量处理
4. 系统会逐个改写，实时更新进度

#### 方式2：单个编辑

1. 点击商品卡片上的 **改写标题** 按钮
2. 在弹窗中：
   - 查看原标题
   - 点击 **AI改写** 生成新标题
   - 手动编辑调整
   - 点击 **保存**

#### 方式3：编辑主图

1. 点击商品卡片上的 **编辑主图** 按钮
2. 自动跳转到 Xobi 图片工作台
3. 使用 Xobi 的所有功能编辑图片
4. 编辑完成后返回列表

### 第六步：导出结果

1. 点击右上角 **导出Excel**
2. 系统生成新的Excel文件，包含：
   - 原始所有列
   - **新标题** 列
   - **新图片URL** 列
   - **处理状态** 列
3. 自动下载文件

---

## 核心功能

### 1. 图片代理

自动代理 Shopee、淘宝等平台的图片，解决防盗链问题。

**原理**:
- 前端通过 `/api/proxy-image?url=xxx` 访问图片
- 后端伪装浏览器请求，绕过防盗链
- 支持多图URL（逗号分隔）

### 2. AI标题仿写

调用云雾 API（Gemini），智能改写商品标题。

**支持**:
- 多语言互转（泰语→中文，中文→英语等）
- 多种风格（简洁/吸睛/本地化）
- 保持核心卖点，提升转化率

### 3. 表格可视化

将枯燥的Excel表格转为直观的商品卡片。

**特性**:
- 网格布局
- 图片预览
- 搜索和筛选
- 分页显示

### 4. 批量处理

支持一次处理上百个商品。

**优势**:
- 进度追踪
- 失败重试
- 实时更新
- 可暂停/继续

---

## 常见问题

### Q1: 图片无法显示怎么办？

**A**: 检查以下几点：
1. 图片URL是否正确
2. 是否需要代理（Shopee等平台图片）
3. 网络连接是否正常

如果使用代理后仍无法显示，可能是原图已失效。

### Q2: 标题改写失败？

**A**: 可能原因：
1. 未配置云雾 API Key（在设置页面配置）
2. API Key 余额不足
3. 网络问题

解决方案：
- 在 `settings.html` 配置 API Key
- 检查 API Key 余额
- 查看浏览器控制台错误信息

### Q3: 支持多大的Excel文件？

**A**:
- 推荐：500行以内
- 最大：10,000行
- 超大文件建议分批处理

### Q4: 导出的Excel在哪里？

**A**: 导出文件保存在：
- 服务器端：`./data/outputs/`
- 客户端：浏览器下载目录

### Q5: 可以同时处理图片和标题吗？

**A**: 可以！工作流程：
1. 先批量改写标题
2. 再逐个编辑主图（跳转到Xobi工作台）
3. 最后导出Excel

---

## 技术架构

### 后端API

```
POST /api/excel/upload        # 上传Excel
POST /api/excel/parse         # 解析Excel
POST /api/excel/export        # 导出Excel
GET  /api/proxy-image         # 图片代理
POST /api/title/rewrite       # 标题仿写
POST /api/title/batch-rewrite # 批量仿写
```

### 前端页面

```
frontend/
├── batch-import.html         # Excel导入页面
└── assets/js/
    └── batch-import.js       # 交互逻辑
```

### 依赖库

**后端**:
- FastAPI - Web框架
- pandas - 数据处理
- openpyxl - Excel操作
- httpx - HTTP客户端

**前端**:
- 原生JavaScript
- TailwindCSS - 样式
- Fetch API - 网络请求

---

## 最佳实践

### 1. Excel表格准备

✅ **推荐格式**:
- 第一行为列名
- 列名清晰明确（如"产品名称"而非"名字"）
- 图片URL完整有效
- 无合并单元格

❌ **避免**:
- 复杂的嵌套结构
- 大量空行
- 特殊字符

### 2. 批量处理策略

**小批量测试**:
1. 先用10个商品测试
2. 检查结果质量
3. 调整参数
4. 再批量处理

**分批处理**:
- 每批 50-100 个
- 避免一次处理过多
- 降低失败风险

### 3. 标题改写技巧

**选择合适的风格**:
- 简洁：适合专业B2B
- 吸睛：适合C端电商
- 本地化：适合跨境电商

**手动优化**:
- AI生成后手动微调
- 添加品牌信息
- 检查语法错误

---

## 更新日志

### v1.0.0 (2026-01-04)
- ✨ 首次发布
- ✅ Excel上传解析
- ✅ 字段智能映射
- ✅ 商品可视化展示
- ✅ AI标题仿写
- ✅ 图片代理功能
- ✅ 批量处理
- ✅ Excel导出

---

## 技术支持

如遇问题，请：
1. 查看浏览器控制台错误
2. 检查后端日志
3. 参考 `项目整合方案.md`

---

**文档版本**: v1.0
**更新时间**: 2026-01-04
**作者**: Xobi Team
