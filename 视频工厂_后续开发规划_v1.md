# 视频工厂（Video Workstation）后续开发规划 v1

> 目的：把“视频工厂”从一个独立子工程，升级为门户内**沉浸式工作台**的一部分，形成「项目留档 → 分镜/脚本 → 生成 → 下载/入库」的闭环；本文件只做规划留档，后续按优先级逐步开发落地。

## 1. 目标与边界

### 目标（必须做到）
- **项目化留档**：视频相关的输入/脚本/分镜/参数/产物都能回到“项目归档/资源库/任务中心”里追溯。
- **工作台闭环**：`项目列表 → 项目工作台 → 分镜/脚本 → 生成/下载 → 入库` 全链路可用。
- **统一设置**：视频相关模型与 API Key 从门户设置统一管理，并可“一键测试连接/保存/同步到 video-workstation”。
- **统一任务**：所有生成任务进入 Jobs，可取消/重试/查看日志/下载产物。

### 边界（v1 暂不做，但保留接口/占位）
- 时间轴级别的专业剪辑（多轨、关键帧、转场库等）先不做专业化，优先做“电商短视频产能”。
- 自动上架到平台（TikTok/Shopee 等）先不做，先把“导出/入库”打通。

## 2. 用户路径（建议 IA / 路由）

### 2.1 路由
- `/video`：视频项目列表（创建/搜索/筛选/最近打开/模板）
- `/video/:projectId`：视频项目工作台（脚本/分镜/生成/产物）

### 2.2 工作台分区（建议 3 栏布局）
- **左侧：项目结构**
  - 分镜列表（Scene 1..N）：状态、时长、素材引用、生成结果
  - 脚本大纲（可折叠）
- **中间：主工作区**
  - 分镜卡片视图（Storyboard）：每个 Scene 预览 + 参数 + 操作
  - 产物预览（生成后：视频/封面/字幕/配音）
- **右侧：工具面板（Dock/Drawer）**
  - Agent（脚本/分镜/提示词/镜头语言）
  - Assets（挑选素材、参考视频、BGM、产品图）
  - Jobs（任务进度、失败原因、重试）

## 3. 功能拆解（按“能用优先”）

### 3.1 项目列表（/video）
- 创建项目：名称、平台（TikTok/Temu 等）、时长目标、风格模板（口播/产品展示/混剪）
- 列表能力：搜索、状态筛选（草稿/生成中/已完成/失败）、最近打开
- 快捷入口：
  - 从 Assets 选“产品图/参考视频”创建项目
  - 从 Excel 数据集行跳转创建（后续）

### 3.2 项目工作台（/video/:id）

#### A) 脚本（Script）
- 生成脚本：输入产品卖点/受众/平台/语气/语言，产出：
  - 口播文案（可分段）
  - 镜头建议（每段对应一个 Scene）
  - CTA/标签建议（可选）
- 编辑脚本：支持版本保存、对比、回滚（v1 可先只做“保存历史”）

#### B) 分镜（Storyboard / Scenes）
- 自动切分：脚本 → N 个 Scene（每个 Scene 约 2～5 秒）
- Scene 卡片字段（建议）：
  - `title` / `voiceover_text` / `visual_prompt`
  - `duration_sec` / `ratio`（9:16 默认）
  - `assets`（引用的产品图/背景图/参考视频/音乐）
  - `status`（draft/queued/running/succeeded/failed）
- 可视化：分镜卡片网格 + 单个 Scene 详情抽屉

#### C) 生成（Generate）
- 单 Scene 生成：对选中 Scene 生成视频片段（产物入库）
- 批量生成：N 个 Scene 一键生成（并发受控）
- 合成导出（稳定优先的方式）：
  - v1 推荐 **“服务端合成”**：后端拉取片段 + 拼接 + 生成最终视频
  - 产出：`final.mp4` + `cover.jpg` + `subtitles.srt`（可选）

#### D) 下载/入库（Archive）
- 任意产物一键写入 Assets（分类：Video/Audio/Image/Subtitle/Zip）
- 一键打包下载：项目导出 zip（脚本+分镜 JSON+视频+字幕）
- 项目完成标记：支持“归档/复制/生成模板”

## 4. 数据模型（建议最小结构）

> v1 可以先落 `video-workstation` 自己的存储，再逐步迁移到统一后端；但字段建议先按统一口径设计，避免返工。

- `VideoProject`
  - `id`, `name`, `platform`, `language`, `ratio`, `target_duration_sec`
  - `script_versions[]`（或 `script_current` + `script_history`）
  - `scenes[]`（Scene 列表）
  - `created_at`, `updated_at`
- `VideoScene`
  - `id`, `project_id`, `order`
  - `voiceover_text`, `visual_prompt`, `duration_sec`
  - `asset_refs[]`（引用 Assets 的 id/url）
  - `job_id`（对应统一 Jobs）
  - `result_asset_id`（片段视频入库后的 Asset id）
- `VideoExport`
  - `project_id`, `final_job_id`, `final_asset_id`, `pack_asset_id`

## 5. API 改造点（对接统一门户）

### 5.1 统一设置（已具备基础：后续完善）
- 门户侧：`/settings` 维护 3 个核心配置：
  - 多模态（Agent/识图/聊天/分析）
  - 生图（图片生成）
  - 视频（云雾）
- 一键“测试连接/保存/同步到 video-workstation”

### 5.2 统一 Jobs/Assets（建议落地顺序）
1) video-workstation 生成任务返回 `job_id`（或门户代理层生成 unified job 记录）
2) 生成产物必须注册为 Asset（可下载/可复用/可引用到 Scene）
3) 门户 Jobs 页面能看到视频任务（进度/日志/重试）

## 6. MVP 里程碑（建议）

### v0（可跑通）
- `/video` 列表 + 创建项目
- `/video/:id` 支持：脚本输入 → 自动切分 N 个 Scene → 单 Scene 生成 → 产物可下载

### v1（可交付）
- 批量生成 N Scenes
- 服务端合成导出 final + 打包 zip
- 全量入库 Assets + 统一 Jobs 追踪

### v2（体验增强）
- Agent 深度联动：对选中 Scene 提建议/改写/补镜头
- 模板系统：口播/混剪/产品对比/活动促销等
- 从 Excel/批量工厂一键生成“商品短视频”项目（桥接）

