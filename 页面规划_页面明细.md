# 页面规划 - 页面明细（功能规划到页面/组件）

> 目的：把“功能规划”落到具体页面，明确哪些能力复用现有实现、哪些需要补齐。
> UI：React + Ant Design + Ant Design X（全局 Agent 抽屉）。

---

## 0) 全局通用（每页都应该一致）

### 0.1 顶栏
- 当前 Project（可选）：切换/新建/绑定到 Excel 行
- 当前 Dataset（可选）：切换/导出/查看模板
- 快捷入口：资源库、任务中心、设置

### 0.2 三个全局抽屉
- **Agent 抽屉（Ant Design X）**：对话 + 可执行建议（填充表单/发起 Job）
- **Assets 抽屉**：搜索/筛选/拖拽把 Asset 插入当前页面表单
- **Jobs 抽屉**：查看运行中任务、取消/重试、打开详情

---

## 1) 仪表盘（/）

### 目的
让用户 10 秒内进入正确的工作流（项目 or 批量）。

### 模块
- 最近 Projects（复用 A：历史项目列表能力）
- 最近 Datasets（Excel 导入历史）
- 最近 Jobs（任务列表 + 失败重试）
- 快捷卡片：
  - 新建项目（多图详情页）
  - 导入 Excel（批量上架）
  - 单图工厂（替换/风格）
  - 打开编辑器

---

## 2) 项目（Projects）

### 2.1 项目列表（/projects）
- 复用：`xobixiangqing/frontend/src/pages/History.tsx` 的能力
- 增强：
  - 绑定/显示：该 Project 是否来自某个 DatasetItem（显示 SKU/平台）
  - 批量导出：将选中项目产物回写到 Excel（若绑定）

### 2.2 创建向导（/projects/new）
- 复用：`xobixiangqing/frontend/src/pages/Home.tsx` 的创建逻辑（但 UI 要 AntD 化）
- 关键输入：
  - 商品信息（title/卖点/规格/平台风格）
  - 模板图 or 风格描述
  - 素材（产品图/参考图）
  - 参考文件（MinerU）
- 输出：
  - 创建 Project + 关联素材/参考文件

### 2.3 大纲/描述/预览（/projects/:id/*）
- 复用：OutlineEditor/DetailEditor/ImagePreview
- 必须加入的“工厂增强”入口：
  - 视觉标注（B：/api/vision/*）
  - 画布标注（B：ChatCanvas，详见 `tupian-de-tu/CANVAS_ANNOTATION_README.md`）
  - 编辑器（B：/api/editor/*）
  - Studio 方向（B：/api/studio/plan + /api/style/*）
- 产物落点：
  - 保存为 PageImageVersion（A 现成）
  - 同步到 Asset（新统一资源抽象）

---

## 3) 批量工作台（Excel 桥接）（/excel）

### 3.1 Dataset 列表（/excel）
- 展示：导入时间、平台模板、行数、完成度、最近导出
- 操作：打开、归档、复制导出配置

### 3.2 Dataset 详情（/excel/:jobId）
> 这里的 jobId 实际建议升级为 datasetId（兼容期可用 jobId 过渡）。

页面结构（推荐固定 5 步，减少复杂度）：
1. 导入信息（原始文件、模板、列预览）
2. 字段映射（Mapping）
3. 数据视图（Table/Gallery + Compare）
4. 批量动作（Actions → Jobs）
5. 导出（ExportProfile → Excel）

v1 冻结口径：默认模板先按 `taiyang.xlsx` 做闭环（导出图片列优先 `image1..image9`，并支持 append/overwrite）。

复用来源：
- UI 交互基准：`tupian-de-tu/frontend/assets/js/batch-import-v2.js`
- 后端能力：
  - Excel：B 的 `/api/excel/*`
  - Proxy：B 的 `/api/proxy-image`
  - Title rewrite：优先补齐 B 的 batch 接口（可从 C/Excel智能处理迁移）
  - Style batch：B 的 `/api/style/batch/*`
  - Replace batch：B 的 `/api/replace/batch/*`

必须补齐（为了“共享项目/素材/任务”成立）：
- 行绑定 Project：按钮“生成详情页/打开项目”，并显示项目状态
- 行资产落库：新图/新标题/日志都要可追踪（Jobs/Assets）

---

## 4) 视觉工厂（/factory）

### 4.1 单图工厂（/factory/single）
复用来源：
- `tupian-de-tu/frontend/single-antdx.html` 的交互与能力（是最完整页面）
- B 的 Replace/Studio/Vision/Editor/Style API

页面模块建议拆分为 4 区：
1) 输入区：产品图/参考图/文案/平台参数  
2) Studio/Agent 区：方向/计划/对话驱动  
3) 预览与候选区：低清预览/候选列表/保存为 Asset/保存到 Project 页  
4) 标注与编辑区：画布标注、视觉标注、编辑器后处理

### 4.2 批量替换（/factory/batch）
复用来源：
- B 的 `/api/replace/batch/*`
- 前端可先复用静态 `batch-antdx.html` 的交互，再 React 化

### 4.3 风格批量（/factory/style-batch）
复用来源：
- B 的 `/api/style/batch/*`
- Excel 页也会用到同一个能力（这里主要给“非 Excel 场景”的入口）

---

## 5) 编辑器（/editor）
复用来源：
- B 的 `/api/editor/*`（服务端处理）
- UI 可先用现有 `editor-antdx.html` 作为参考，逐步 React 化

必须补齐：
- 输入必须支持来自 Asset（而不只是上传文件）
- 产物必须保存为新 Asset/新版本，并能回写 Project/DatasetItem

---

## 6) 资源库（/assets）

Tab 建议：
- 图片素材（Material/Asset Image）
- 模板（UserTemplate/SystemTemplate）
- 参考文件（ReferenceFile + parse status）
- 导出文件（zip/xlsx）

必须补齐：
- 标签/检索（后续 P2，但 UI 结构先预留）
- “一键加入当前项目/当前 Excel 行”的动作（共享的关键）

---

## 7) 任务中心（/jobs）

目的：让批量任务可追踪、可重试、可导出，减少“跑丢了/不知道跑到哪了”的成本。

模块：
- Job 列表（过滤：project/dataset/type/status）
- Job 详情（输入资产、输出资产、日志、重试/取消）

必须补齐：
- 统一 Job API（见 `待补齐_缺失功能清单.md` 的 P0-1）

---

## 8) 设置（/settings）

MVP：沿用 A 的 Settings（DB 存储）作为唯一真相。  
后续：增加项目级 profile（品牌档案），用于 Studio 与项目生成共享。
