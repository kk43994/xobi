# 实施路线图（重组完整版本）

> 目标：先把“统一门户 + 共享数据模型”跑起来，再逐步把三套功能收敛为一个可维护的工程。
> 你当前偏好：先规划清楚再动手；本路线图把“做什么/做到什么算完成”写死，便于三人协作不跑偏。

---

## 阶段 0：冻结规划（0.5～1 天）

交付物（文档已基本齐）：
- `整合蓝图_v1.md`
- `页面规划_统一门户IA.md`
- `页面规划_页面明细.md`
- `批量工作台_Excel桥接设计.md`
- `待补齐_缺失功能清单.md`

需要你拍板的 2 件事（否则后面无法落地 ExportProfile）：
1) Top1-2 上架平台模板  
   - 你已确认优先支持：**Shopee / SHEIN / Amazon / TikTok / Temu**  
   - v1 先以 **`taiyang.xlsx`** 作为首个预置导出模板（可视为 Shopee 生态样表），先把闭环跑通  
   - Top2 模板：后续再补（你给样表 or 我去找官方模板），建议优先 TikTok Shop 用来验证差异
2) 图片字段格式偏好（单列逗号 vs 多列 image1/image2/...）  
   - v1 以 **`taiyang.xlsx`** 为准：`产品图片` 仍是 **单列逗号分隔**（平台可直接识别）
   - 同时支持“可选追加列”：导出时可追加 `image1..imageN`（不破坏原表，方便后续适配其它平台）

---

## 阶段 1：新门户“壳”落地（2～4 天）

目标：在一个 React + AntD + AntDX 门户里能访问到所有核心能力（哪怕先是嵌入/跳转）。

工作项：
- 新建门户工程（建议基于 `xobixiangqing/frontend` 重构到 AntD 风格）
- 路由/导航按 IA 搭好（/projects、/excel、/factory、/editor、/assets、/jobs、/settings）
- 路由/导航按 IA 搭好（/projects、/excel、/factory、/editor、/agent、/assets、/jobs、/settings）
- 全局抽屉（Agent/Assets/Jobs）先做“外壳 + mock”，后续逐步接后端
- 提供一个“统一启动器”（根目录 `Xobi启动器.bat`），一键启动门户 + A 后端 + B 工具服务，避免 AB 割裂
- 先把 B 的静态页当作“原型能力”接入（临时方案）：
  - /factory/single → iframe/新窗口打开 `single-antdx.html`
  - /excel/legacy → iframe/新窗口打开 `batch-antdx.html`
  - /editor → iframe/新窗口打开 `editor-antdx.html`
  - /agent → iframe/新窗口打开 `chat-antdx.html`

完成标准：
- 用户不用再在三个目录里找入口（统一从门户进入）

---

## 阶段 2：统一“数据底座”接口（Job/Asset/Dataset）（4～7 天）

目标：开始实现“共享项目/素材/任务/批量”的核心价值。

工作项（后端优先落在 A，也可新建 core-service 复用 A 的 DB）：
- Job API（最小可用）：list/get/cancel/retry
- Asset API（最小可用）：upload/list/get/download（先只支持图片与 excel/zip）
- Dataset API（最小可用）：create-from-excel、get、list、items list、update item results
- 规定所有工具箱输出必须回写为 Asset（哪怕 B 仍然落盘 outputs，也要在 core 侧注册成 Asset）

完成标准：
- 门户的“资源库/任务中心”开始可用
- Excel 页能看见“某一行生成的新图/新标题”并可追踪任务

---

## 阶段 3：把 B 的强功能“产品化接入”（7～14 天）

目标：不是简单嵌入页面，而是把 Replace/Style/Editor/Vision/Canvas 变成可复用模块。

工作项：
- Factory Single React 化：把 `single-antdx.html` 的核心交互拆成组件
- Canvas 标注（ChatCanvas）接入：
  - 在 Project Preview 与 Factory Single 都能标注
  - 标注 → Agent 归纳 → 发起 Edit/Replace/Style Job
- Editor 接入 Asset：
  - 输入来自 Asset/Project Page
  - 输出写回 Asset + PageImageVersion（或 DatasetItem）
- Vision/Studio 接入统一 Agent 抽屉（建议“工具结果”可一键写入表单）

完成标准：
- 任意页面生成的图片都能回到资源库复用
- 任意任务都能在任务中心追踪/重试/下载

当前进度（已落地）：
- 主图工厂已提供“内置版”（非 iframe）：`/factory/single`（A 代理 B Replace/Style 单图 → 回写 Asset/Job）

---

## 阶段 4：Excel → Project 的批量桥接（第二个闭环）（1～2 周）

目标：让“批量上架”不仅能改标题/改主图，还能批量生成详情页多图并导出上架表。

工作项：
- DatasetItem → Project 的生成规则固化（如何编译 idea_prompt、如何挂素材/参考图）
- 一键批量生成详情页（N 行 → N 个 Project → 多图产出）
- ExportProfile 先落地 `taiyang.xlsx`（v1 可用闭环），再逐步补齐 Top2/其它平台模板差异
  - 已完成 v1：Dataset 导出上架 Excel（`POST /api/datasets/:id/export-excel`；Excel 页已提供“导出上架 Excel”入口）

完成标准：
- 从 Excel 导入一批 SKU → 批量产出主图/详情图/标题 → 导出可上架 Excel

---

## 延后事项（你说暂不做，但建议留接口）

- 最小鉴权（admin token）
- 搜索/标签/检索
- 成本/耗时/失败原因聚类（可观测性）
